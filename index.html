<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Universe Connected: The Game</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="manifest" href="/manifest.json">
  <style>
    /* Basic setup */
    html, body, #root {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden; /* Prevent scrollbars */
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #000;
      color: #fff;
      /* Prevent mobile zoom and text selection */
      touch-action: none;
      -webkit-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    /* Custom Glow Effect */
    .glow-text {
      text-shadow: 0 0 5px rgba(173, 216, 230, 0.6), 0 0 10px rgba(173, 216, 230, 0.5), 0 0 15px rgba(144, 238, 144, 0.4);
    }

    /* Splash Screen Animations & Menu */
    .splash-screen {
      background: radial-gradient(ellipse at center, #0a0a1a 0%, #000000 70%);
    }

    @keyframes fadeInSlow {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .splash-menu-item {
        animation: fadeInSlow 2s ease-out forwards;
        opacity: 0;
    }

    .splash-menu-button {
      background: rgba(17, 24, 39, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.5);
      backdrop-filter: blur(4px);
      transition: all 0.3s ease;
    }
    .splash-menu-button:hover:not(:disabled) {
        background: rgba(79, 70, 229, 0.5);
        border-color: rgba(167, 139, 250, 0.8);
        transform: translateY(-2px);
    }
     .splash-menu-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
     }
     
    .dev-menu-button {
        background: rgba(17, 24, 39, 0.4);
        border: 1px solid rgba(139, 92, 246, 0.3);
        backdrop-filter: blur(2px);
        transition: all 0.3s ease;
        font-size: 0.9rem;
        padding: 0.5rem 1rem;
        border-radius: 6px;
    }
    .dev-menu-button:hover {
        background: rgba(79, 70, 229, 0.4);
        border-color: rgba(167, 139, 250, 0.6);
    }

    .animate-fade-in-slow {
      animation: fadeInSlow 3s ease-out forwards;
    }
    
    .splash-nebula {
        position: absolute;
        width: 60vmin;
        height: 60vmin;
        background: radial-gradient(circle, rgba(168, 85, 247, 0.3) 0%, rgba(79, 70, 229, 0.2) 40%, rgba(13, 148, 136, 0.1) 70%, transparent 80%);
        border-radius: 50%;
        filter: blur(20px);
        animation: spin 80s linear infinite, pulse 8s ease-in-out infinite alternate;
    }
    
    /* Particle animations for splash and background */
    .particle-container {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      border-radius: 50%;
      width: var(--size);
      height: var(--size);
      animation: move var(--duration) var(--delay) linear infinite;
    }

    .particle-neutral { background-color: rgba(200, 200, 255, 0.3); }

    @keyframes move {
      from {
        transform: translate(var(--x-start), var(--y-start));
        opacity: 0.8;
      }
      to {
        transform: translate(var(--x-end), var(--y-end));
        opacity: 0;
      }
    }

    /* Simulation View */
    .simulation-container {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      cursor: none;
    }
    
    .world-container {
      position: absolute;
      will-change: transform;
    }

    .playable-area-boundary {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle, transparent 95%, rgba(0, 246, 255, 0.1) 98%, rgba(0, 246, 255, 0.2) 100%);
        pointer-events: none;
        box-shadow: inset 0 0 50px rgba(0, 246, 255, 0.1);
        transform: translate(-50%, -50%);
    }

    /* Level Zoom Out Animation */
    .world-container.level-zoom-out {
      animation: level-zoom-out-anim 3s cubic-bezier(0.6, 0.04, 0.98, 0.335) forwards;
    }
    @keyframes level-zoom-out-anim {
        100% {
            /* The animation overrides the inline style, so we have to re-apply the base translate */
            transform: translate(calc(100vw / 2)) translate(calc(100vh / 2)) scale(0.01);
            opacity: 0;
        }
    }


    .connections-svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 1px;
        height: 1px;
        overflow: visible;
        pointer-events: none;
    }
    
    .node-container {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: -50%;
      margin-top: -50%;
      pointer-events: all;
      cursor: pointer;
      transform-origin: center center;
      transition: transform 0.5s ease;
    }
    
    .node-container.aim-assist-target::after {
        content: '';
        position: absolute;
        inset: -8px;
        border: 2px solid #00f6ff;
        border-radius: 50%;
        animation: pulse-aim-target 1.5s infinite;
        pointer-events: none;
    }
    @keyframes pulse-aim-target {
        0% { transform: scale(1); opacity: 0.7; }
        50% { transform: scale(1.1); opacity: 1; }
        100% { transform: scale(1); opacity: 0.7; }
    }


    .node-container.tunnel-out {
      transform: scale(0);
    }
    .node-container.tunnel-in {
      animation: tunnel-in-anim var(--tunnel-duration, 1s) ease-out;
    }
    @keyframes tunnel-in-anim {
      from { transform: scale(0); }
      to { transform: scale(1); }
    }
    
    .node-image {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      position: relative;
    }
    
    .node-image.star {
        animation: spin-slow 120s linear infinite;
    }
    .node-image.rocky_planet, .node-image.life_seed, .node-image.sentient_colony {
        animation: spin-slow 80s linear infinite;
    }
    
    .node-image.star::before {
      content: '';
      position: absolute;
      inset: -20%;
      border-radius: 50%;
      background: radial-gradient(circle, transparent 60%, rgba(255, 204, 0, 0.7) 80%, transparent 90%);
      animation: spin 20s linear infinite alternate;
      z-index: -1;
    }
    
    .node-image.star::after {
        content: '';
        position: absolute;
        top: 50%;
        left: -50%;
        width: 200%;
        height: 2px;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
        animation: flare-pulse 4s ease-in-out infinite, spin 30s linear infinite;
        transform-origin: center;
    }
    @keyframes flare-pulse { 0%, 100% { transform: scaleX(1); opacity: 0.8; } 50% { transform: scaleX(1.1); opacity: 0.4; }}
    
    .node-image.sentient_colony::before {
        content: '';
        position: absolute;
        inset: -15%;
        border-radius: 50%;
        background: radial-gradient(circle, transparent 70%, rgba(192, 132, 252, 0.5) 85%, transparent 100%);
        animation: spin 15s linear infinite, pulse 3s ease-in-out infinite;
        mix-blend-mode: screen;
        z-index: -1;
    }
    
    .node-image.player_consciousness::before {
        content: '';
        position: absolute;
        inset: -10%;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(0, 246, 255, 0.3), transparent 70%);
        animation: pulse-player-core 2.5s ease-in-out infinite;
        z-index: -1;
    }
    .node-image.player_consciousness::after {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 50%;
        background: radial-gradient(circle, transparent, rgba(0, 246, 255, 0.2));
        animation: spin 20s linear infinite reverse;
    }
    @keyframes pulse-player-core { 0%, 100% { transform: scale(1); box-shadow: 0 0 15px #00f6ff, 0 0 30px #00f6ff, 0 0 45px #ffffff; } 50% { transform: scale(1.1); box-shadow: 0 0 25px #00f6ff, 0 0 50px #00f6ff, 0 0 75px #ffffff; } }

    /* Quantum Tunneling Visuals */
    .node-image.can-tunnel {
        animation: quantum-shimmer 4s infinite;
    }
    @keyframes quantum-shimmer {
      0%, 100% { filter: hue-rotate(0deg) brightness(1); }
      10%, 30%, 50%, 70%, 90% { filter: hue-rotate(10deg) brightness(1.2) drop-shadow(0 0 2px #00f6ff); }
      20%, 40%, 60%, 80% { filter: hue-rotate(-10deg) brightness(0.9) drop-shadow(0 0 2px #a855f7); }
    }


    .node-placeholder {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: radial-gradient(circle, #555, #222);
    }
    
    .energy-orb {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle, #fff, #fde047);
        box-shadow: 0 0 8px #fde047, 0 0 12px #fef08a;
        margin-left: -50%;
        margin-top: -50%;
        transition: all 0.3s ease;
    }

    .energy-orb.bloom {
        box-shadow: 0 0 15px #fefce8, 0 0 25px #fde047, 0 0 40px #fbbf24;
        transform: scale(1.1);
    }
    
    .connection-pulse {
        position: absolute;
        height: 2px;
        background: linear-gradient(90deg, transparent, #00f6ff, transparent);
        border-radius: 2px;
        box-shadow: 0 0 5px #00f6ff;
        transform-origin: 0% 50%;
        margin-top: -1px; /* Center it */
    }

    .collection-effect {
        position: absolute;
        border-radius: 50%;
        border: 2px solid #fef08a;
        margin-left: -50%;
        margin-top: -50%;
        pointer-events: none;
    }
    
    .collection-bloom {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle, #fff, #fde047);
        margin-left: -50%;
        margin-top: -50%;
        pointer-events: none;
        animation: bloom-anim 0.4s ease-out forwards;
    }
    @keyframes bloom-anim {
        0% {
            transform: scale(1);
            opacity: 1;
            box-shadow: 0 0 8px #fde047, 0 0 12px #fef08a;
        }
        100% {
            transform: scale(2.5);
            opacity: 0;
            box-shadow: 0 0 20px #fefce8, 0 0 35px #fde047, 0 0 50px #fbbf24;
        }
    }

    .collection-flare {
        position: absolute;
        width: 2px;
        height: 10px;
        background: linear-gradient(to top, transparent, #fef08a);
        transform-origin: 50% 100%;
        pointer-events: none;
        animation: flare-anim 0.4s ease-out forwards;
    }
    @keyframes flare-anim {
        0% {
            transform: rotate(var(--angle)) translateY(0) scaleY(1);
            opacity: 1;
        }
        100% {
            transform: rotate(var(--angle)) translateY(-50px) scaleY(0.5);
            opacity: 0;
        }
    }
    
    /* New Projection Mechanic UI */
    .aim-indicator {
      position: absolute;
      height: 2px;
      background: linear-gradient(90deg, rgba(0, 246, 255, 0.8), rgba(0, 246, 255, 0));
      transform-origin: 0% 50%;
      pointer-events: none;
      box-shadow: 0 0 8px rgba(0, 246, 255, 0.7);
      margin-top: -1px; /* Center it */
      transition: all 0.2s ease-out;
    }
    .aim-indicator.locked-on {
        background: linear-gradient(90deg, #fef08a, rgba(0, 246, 255, 0));
        box-shadow: 0 0 12px #fef08a;
    }

    #power-meter-container {
        position: absolute;
        transform: translate(-50%, -50%);
        pointer-events: none;
    }
    .power-meter-bg {
        stroke: rgba(0, 246, 255, 0.2);
    }
    .power-meter-fg {
        stroke: #00f6ff;
        stroke-linecap: round;
        transition: stroke-dashoffset 0.05s linear;
    }
    
    .projectile-trail {
        position: absolute;
        width: 4px;
        height: 80px;
        background: linear-gradient(to top, transparent, rgba(0, 246, 255, 0.7));
        border-radius: 2px;
        transform-origin: 50% 100%;
        margin-left: -2px;
        margin-top: -80px;
    }

    .reforming-particle {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle, white, #00f6ff 70%, transparent 100%);
        box-shadow: 0 0 8px #00f6ff;
        animation: reform-anim 2s ease-out forwards;
    }

    @keyframes reform-anim {
        0% {
            transform: translate(var(--x-start), var(--y-start)) scale(1);
            opacity: 1;
        }
        100% {
            transform: translate(0, 0) scale(0);
            opacity: 0;
        }
    }


    /* Quantum Phage Styling */
    .phage-entity {
        position: absolute;
        margin-left: -50%;
        margin-top: -50%;
        background: radial-gradient(circle, #ff0055, #aa00ff);
        box-shadow: 0 0 10px #ff0055, 0 0 20px #aa00ff;
        animation: glitch 1.5s infinite, pulse 3s infinite;
        clip-path: polygon(50% 0%, 80% 10%, 100% 35%, 100% 70%, 80% 90%, 50% 100%, 20% 90%, 0% 70%, 0% 35%, 20% 10%);
    }
    
    .phage-entity::before, .phage-entity::after {
        content: '';
        position: absolute;
        inset: 0;
        background: inherit;
        box-shadow: inherit;
        animation: glitch 1.5s infinite reverse;
        clip-path: inherit;
        mix-blend-mode: screen;
    }
    .phage-entity::before { animation-delay: 0.1s; transform: translate(3px, -3px); }
    .phage-entity::after { animation-delay: -0.1s; transform: translate(-3px, 3px); }

    @keyframes glitch {
      2%, 64% { transform: translate(2px, -2px) skew(2deg); }
      4%, 60% { transform: translate(-2px, 2px) skew(-2deg); }
      62% { transform: translate(0, 0) skew(0); }
    }


    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.8; } }
    
    /* --- Cosmic Event Styling --- */
    .anomaly-particle {
        position: absolute;
        border-radius: 50%;
        background-color: #a78bfa;
        box-shadow: 0 0 8px #c4b5fd;
        margin-left: -50%;
        margin-top: -50%;
        pointer-events: none;
    }

    .anomaly-vortex {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle, transparent 30%, rgba(139, 92, 246, 0.1) 50%, rgba(139, 92, 246, 0.4) 100%);
        animation: spin 5s linear infinite, pulse-anomaly 3s ease-in-out infinite;
        transform-origin: center;
        margin-left: -50%;
        margin-top: -50%;
        pointer-events: none;
    }
    @keyframes pulse-anomaly {
        0%, 100% { transform: scale(1); opacity: 0.7; }
        50% { transform: scale(1.1); opacity: 1; }
    }

    .supernova-warning {
        position: absolute;
        border-radius: 50%;
        border: 4px solid #f87171;
        animation: pulse-warning 1s infinite;
        margin-left: -50%;
        margin-top: -50%;
        pointer-events: none;
    }
    @keyframes pulse-warning {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.5; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* New Supernova Effect Classes */
    .supernova-container {
        position: absolute;
        margin-left: -50%;
        margin-top: -50%;
        pointer-events: none;
    }
    .supernova-flash {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle, white 5%, rgba(255, 255, 255, 0) 40%);
        animation: supernova-flash-anim 0.3s ease-out forwards;
    }
    @keyframes supernova-flash-anim {
        from { transform: scale(0.1); opacity: 1; }
        to { transform: scale(1); opacity: 0; }
    }
    .supernova-shockwave {
        position: absolute;
        border-radius: 50%;
        border: 4px solid white;
        animation: supernova-shockwave-anim 1.5s ease-out 0.1s forwards;
    }
    @keyframes supernova-shockwave-anim {
        from { transform: scale(0.1); opacity: 1; }
        to { transform: scale(1); opacity: 0; }
    }
    .supernova-nebula {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(255, 204, 0, 0.6) 10%, rgba(255, 107, 0, 0.4) 40%, transparent 70%);
        animation: supernova-nebula-anim 8s ease-out 0.3s forwards;
    }
     @keyframes supernova-nebula-anim {
        from { transform: scale(0.1); opacity: 1; }
        to { transform: scale(1.2); opacity: 0; }
    }


    .resource-bloom {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(250, 204, 21, 0.05), rgba(250, 204, 21, 0.2) 80%);
        border: 2px solid rgba(250, 204, 21, 0.3);
        pointer-events: none;
        margin-left: -50%;
        margin-top: -50%;
        transition: opacity 1s linear;
    }

    /* Screen Shake & Colorblind Filters */
    .app-container.shaking {
      animation: screen-shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
    .app-container.colorblind-deuteranopia { filter: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"><filter id="deuteranopia"><feColorMatrix type="matrix" values="0.625, 0.375, 0, 0, 0, 0.7, 0.3, 0, 0, 0, 0, 0.3, 0.7, 0, 0, 0, 0, 0, 1, 0" /></filter></svg>#deuteranopia'); }
    .app-container.colorblind-protanopia { filter: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"><filter id="protanopia"><feColorMatrix type="matrix" values="0.567, 0.433, 0, 0, 0, 0.558, 0.442, 0, 0, 0, 0, 0.242, 0.758, 0, 0, 0, 0, 0, 1, 0" /></filter></svg>#protanopia'); }
    .app-container.colorblind-tritanopia { filter: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"><filter id="tritanopia"><feColorMatrix type="matrix" values="0.95, 0.05, 0, 0, 0, 0, 0.433, 0.567, 0, 0, 0, 0.475, 0.525, 0, 0, 0, 0, 0, 1, 0" /></filter></svg>#tritanopia'); }


    @keyframes screen-shake {
      10%, 90% { transform: translate(calc(var(--shake-intensity) * -1), 0); }
      20%, 80% { transform: translate(var(--shake-intensity), 0); }
      30%, 50%, 70% { transform: translate(calc(var(--shake-intensity) * -1), 0); }
      40%, 60% { transform: translate(var(--shake-intensity), 0); }
    }
    
    /* --- HUD & UI REFINEMENT --- */
    .hud-container {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 20;
    }
    .hud-element {
      background: rgba(10, 15, 25, 0.6);
      border: 1px solid rgba(0, 246, 255, 0.2);
      backdrop-filter: blur(4px);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0, 246, 255, 0.1);
    }
    
    .hud-resources {
      position: absolute;
      top: 1rem; left: 1rem;
      display: flex;
      flex-direction: row;
      gap: 1rem;
    }
    .hud-resource-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.1rem;
      font-weight: 500;
      color: #e0f2fe;
    }
    .hud-resource-item svg {
      width: 24px;
      height: 24px;
    }
    
    .hud-top-center {
      position: absolute;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .hud-chapter-info {
      text-align: center;
      color: #93c5fd;
    }
    .hud-chapter-info h2 {
      font-size: 1.25rem;
      font-weight: bold;
      color: #e0f2fe;
      text-shadow: 0 0 5px #00f6ff;
    }

    .hud-chapter-progress-bar {
      width: clamp(250px, 30vw, 400px);
      height: 8px;
      background: rgba(0, 246, 255, 0.15);
      border: 1px solid rgba(0, 246, 255, 0.2);
      border-radius: 4px;
      overflow: hidden;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.5);
    }
    .hud-chapter-progress-fill {
      height: 100%;
      background: #00f6ff;
      box-shadow: 0 0 8px #00f6ff;
      transition: width 0.5s ease-out;
    }
    
    .hud-karma-meter {
      width: clamp(250px, 30vw, 400px);
    }
    .karma-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      margin-bottom: 0.25rem;
      padding: 0 2px;
    }
    .karma-label-chaos { color: #f472b6; }
    .karma-label-harmony { color: #22d3ee; }

    .karma-bar-bg {
      height: 6px;
      background: linear-gradient(90deg, #f472b6, rgba(150,150,150,0.5) 50%, #22d3ee);
      border-radius: 3px;
      position: relative;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
    }
    .karma-indicator {
      position: absolute;
      top: 50%;
      width: 4px;
      height: 12px;
      background: white;
      border-radius: 2px;
      transform: translate(-50%, -50%);
      transition: left 0.5s cubic-bezier(0.25, 1, 0.5, 1);
      box-shadow: 0 0 5px white;
    }

    .hud-action-buttons {
      position: absolute;
      bottom: 1rem;
      right: 1rem;
      display: flex;
      gap: 1rem;
      pointer-events: all;
    }
    .action-button {
      width: 120px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #ccfbf1;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      cursor: pointer;
      position: relative;
      background: linear-gradient(45deg, #14b8a6, #0d9488);
      clip-path: polygon(10% 0%, 90% 0%, 100% 50%, 90% 100%, 10% 100%, 0% 50%);
      transition: all 0.2s ease;
    }
    .action-button:hover {
        transform: scale(1.05);
        color: white;
        text-shadow: 0 0 8px white;
    }
    .action-button.purple {
      background: linear-gradient(45deg, #a855f7, #7e22ce);
    }
    .action-button.blue {
      background: linear-gradient(45deg, #3b82f6, #2563eb);
    }


    /* Tutorial Highlighter */
    .tutorial-highlight {
      position: fixed;
      border: 3px solid #00f6ff;
      border-radius: 8px;
      box-shadow: 0 0 15px #00f6ff;
      transition: all 0.3s ease-in-out;
      pointer-events: none;
      z-index: 100;
    }

    .tutorial-box {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: rgba(17, 24, 39, 0.9);
      border: 1px solid #4f46e5;
      padding: 20px;
      border-radius: 8px;
      max-width: 400px;
      z-index: 101;
      box-shadow: 0 0 20px rgba(79, 70, 229, 0.5);
    }
    
    /* Milestone & Upgrade Visuals */
    .milestone-container {
      position: fixed;
      inset: 0;
      z-index: 200;
      animation: fadeInMilestone 1s ease-out, fadeOutMilestone 1s 5s ease-in forwards;
      pointer-events: none;
    }
    .milestone-scene {
      width: 100%; height: 100%;
      position: relative;
      overflow: hidden;
    }
    .milestone-title {
      position: absolute;
      bottom: 10%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 2.5rem;
      text-align: center;
      color: white;
      text-shadow: 0 0 10px black, 0 0 20px black;
      z-index: 10;
      opacity: 0;
      animation: fadeInSlow 2s 1s forwards;
    }

    @keyframes fadeInMilestone { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeOutMilestone { from { opacity: 1; } to { opacity: 0; } }
    
    /* Basic Physics Animation */
    .physics-container {
        position: relative;
        width: 80vmin;
        height: 80vmin;
        transform-style: preserve-3d;
        animation: spin 30s linear infinite;
    }
    .singularity {
        position: absolute;
        top: 50%; left: 50%;
        width: 4vmin; height: 4vmin;
        border-radius: 50%;
        background: black;
        box-shadow: 0 0 10px 2px white, 0 0 40px 10px #a855f7, 0 0 80px 20px #4f46e5;
        transform: translate(-50%, -50%);
        animation: singularity-pulse 4s ease-in-out infinite alternate;
    }
    @keyframes singularity-pulse {
        to { transform: translate(-50%, -50%) scale(1.2); box-shadow: 0 0 15px 3px white, 0 0 50px 15px #a855f7, 0 0 100px 25px #4f46e5; }
    }
    .physics-particle {
        position: absolute;
        top: 50%; left: 50%;
        width: 3px; height: 3px;
        border-radius: 50%;
        background: #e0e7ff;
        animation: gravity-pull var(--duration) var(--delay) ease-in-out infinite;
    }
    @keyframes gravity-pull {
        0% {
            transform: rotate(var(--angle)) translateX(var(--dist)) scale(1);
            opacity: 1;
        }
        100% {
            transform: rotate(var(--angle)) translateX(5vmin) scale(0);
            opacity: 0;
        }
    }
    
    /* Great Zoom Out Milestone */
    @keyframes zoom-out-universe {
        0% { transform: scale(1); }
        100% { transform: scale(0.001); }
    }
    @keyframes zoom-in-particle {
        0% { transform: scale(0.01) rotate(180deg); opacity: 0; }
        100% { transform: scale(50); opacity: 1; }
    }
    .zoom-out-container {
        animation: zoom-out-universe 8s cubic-bezier(0.6, 0.04, 0.98, 0.335) forwards;
    }
    .particle-zoom-in {
        animation: zoom-in-particle 4s 8s ease-in forwards;
    }

    /* Star Formation Animation */
    .gas-cloud {
        width: 80vmin;
        height: 80vmin;
        background: radial-gradient(circle, rgba(255, 100, 150, 0.2), rgba(100, 100, 255, 0.3), transparent 70%);
        border-radius: 50%;
        filter: blur(40px);
        animation: swirl-condense-ignite 6s ease-in-out forwards;
    }
    @keyframes swirl-condense-ignite {
        0% { transform: scale(1.5) rotate(0deg); opacity: 0.8; filter: blur(40px); }
        70% { transform: scale(0.1) rotate(540deg); opacity: 1; filter: blur(10px); background: radial-gradient(circle, #fff, #ffcc00, transparent 50%);}
        85% { transform: scale(1.2); filter: blur(0); background: radial-gradient(circle, #fff, #ffcc00, transparent 40%); box-shadow: 0 0 50px #ffcc00; }
        100% { transform: scale(1); filter: blur(0); background: radial-gradient(circle, #fff, #ffcc00, transparent 40%); box-shadow: 0 0 40px #ffcc00;}
    }

    /* Planetary Accretion Animation */
    .accretion-disk {
        width: 100vmin;
        height: 100vmin;
        border: 2px solid transparent;
        border-top: 2px solid rgba(255, 229, 180, 0.3);
        border-radius: 50%;
        position: absolute;
        animation: spin 10s linear infinite;
    }
    .proto-planet {
        width: 2vmin;
        height: 2vmin;
        background: #8B4513;
        border-radius: 50%;
        position: absolute;
        box-shadow: 0 0 10px #D2691E;
        animation: planet-form 6s ease-in forwards;
    }
    @keyframes planet-form {
        0% { transform: scale(1); }
        100% { transform: scale(15); background: radial-gradient(circle, #D2B48C, #8B4513); box-shadow: 0 0 30px #A0522D; }
    }

    /* Quantum Computing & Tunneling Animation */
    .qc-grid {
      position: absolute;
      inset: 0;
      background-size: 40px 40px;
      background-image:
        linear-gradient(to right, rgba(0, 255, 255, 0.1) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
      animation: pan-grid 20s linear infinite;
    }
    .qubit {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #00f6ff;
      animation: qubit-flicker 2s infinite;
    }
    @keyframes pan-grid {
      from { background-position: 0 0; }
      to { background-position: -40px -40px; }
    }
    @keyframes qubit-flicker {
      0%, 100% { opacity: 0.5; transform: scale(1); box-shadow: 0 0 5px #00f6ff; }
      50% { opacity: 1; transform: scale(1.2); box-shadow: 0 0 15px #00f6ff; }
    }
    .tunneling-node {
        position: absolute;
        width: 5vmin; height: 5vmin;
        border-radius: 50%;
        background: #c084fc;
        box-shadow: 0 0 15px #c084fc, 0 0 30px #a855f7;
        animation: tunnel-effect 6s ease-in-out forwards;
    }
    @keyframes tunnel-effect {
        0% { transform: translateX(-40vmin) scale(1) rotate(0deg); opacity: 1; }
        20% { transform: translateX(-40vmin) scale(0); opacity: 0; }
        30% { transform: translateX(40vmin) scale(0) rotate(720deg); opacity: 0; }
        50% { transform: translateX(40vmin) scale(1.2) rotate(720deg); opacity: 1; }
        60% { transform: translateX(40vmin) scale(1) rotate(720deg); }
        100% { transform: translateX(40vmin) scale(1) rotate(720deg); }
    }

    /* Radial Menu */
    .radial-menu-container {
        position: absolute;
        pointer-events: none;
        z-index: 15;
    }
    .radial-menu-button {
        position: absolute;
        width: 60px;
        height: 60px;
        background: rgba(17, 94, 89, 0.7);
        border: 2px solid #0d9488;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ccfbf1;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        pointer-events: all;
        box-shadow: 0 0 15px rgba(13, 148, 136, 0.6);
        animation: radial-button-appear 0.4s both;
    }
    .radial-menu-button:hover {
        background: rgba(20, 184, 166, 0.8);
        border-color: #14b8a6;
        transform: scale(1.15) !important;
    }
    .radial-menu-button svg {
        width: 32px;
        height: 32px;
    }
    @keyframes radial-button-appear {
      from { opacity: 0; transform: scale(0.5); }
      to { opacity: 1; transform: scale(1); }
    }
    
    /* Lore Tooltip */
    .lore-tooltip-container {
        position: absolute;
        width: 250px;
        background: rgba(17, 24, 39, 0.9);
        border: 1px solid #4f46e5;
        padding: 12px;
        border-radius: 8px;
        z-index: 16;
        box-shadow: 0 0 20px rgba(79, 70, 229, 0.5);
        animation: tooltip-fade-in 0.3s ease-out;
        pointer-events: all;
    }

    /* Notification Toast */
    .notification-toast {
        animation: notification-fade 3s ease-in-out forwards;
    }
    @keyframes notification-fade {
        0% {
            opacity: 0;
            transform: translateX(100%);
        }
        10% {
            opacity: 1;
            transform: translateX(0);
        }
        90% {
            opacity: 1;
            transform: translateX(0);
        }
        100% {
            opacity: 0;
            transform: translateX(100%);
        }
    }

    @keyframes tooltip-fade-in {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Settings Modal */
    .settings-modal-backdrop {
        position: fixed;
        inset: 0;
        background-color: rgba(0,0,0,0.75);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 250;
    }
    .settings-modal-content {
        background: rgba(17, 24, 39, 0.95);
        border: 1px solid #4f46e5;
        padding: 24px;
        border-radius: 12px;
        width: 100%;
        max-width: 500px;
        box-shadow: 0 0 30px rgba(79, 70, 229, 0.6);
    }
    .settings-modal-content h2 {
        font-size: 1.75rem;
        font-weight: bold;
        color: #c7d2fe;
        margin-bottom: 20px;
        text-align: center;
    }
    .settings-modal-content label {
        display: block;
        margin-bottom: 8px;
        color: #a5b4fc;
    }
     .settings-modal-content input[type="range"] {
        width: 100%;
        cursor: pointer;
     }
     .settings-modal-content select {
        width: 100%;
        padding: 8px;
        background-color: #1e293b;
        border: 1px solid #4f46e5;
        border-radius: 4px;
        color: white;
     }
     
    /* Node Inspector Panel */
    .node-inspector-panel {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        width: 320px;
        background: rgba(10, 20, 35, 0.8);
        backdrop-filter: blur(8px);
        border-left: 1px solid rgba(79, 70, 229, 0.7);
        transform: translateX(100%);
        transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        z-index: 30;
        display: flex;
        flex-direction: column;
        color: #e5e7eb;
    }
    .node-inspector-panel.visible {
        transform: translateX(0);
    }
    .node-inspector-close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 2.5rem;
        line-height: 1;
        color: #9ca3af;
        background: none;
        border: none;
        cursor: pointer;
        transition: color 0.2s;
    }
    .node-inspector-close:hover {
        color: #fff;
    }
    .node-inspector-header {
        padding: 20px;
        text-align: center;
        border-bottom: 1px solid rgba(79, 70, 229, 0.5);
    }
    .node-inspector-image-container {
        width: 100px;
        height: 100px;
        margin: 0 auto 15px;
        border: 2px solid #4f46e5;
        border-radius: 50%;
        padding: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #000;
    }
    .node-inspector-image-container .node-image {
        width: 100%;
        height: 100%;
    }
    .node-inspector-header h2 {
        font-size: 1.5rem;
        font-weight: bold;
        color: #c7d2fe;
    }
    .node-inspector-header p {
        font-size: 1rem;
        color: #a5b4fc;
        text-transform: capitalize;
    }
    .node-inspector-body {
        padding: 20px;
        flex-grow: 1;
        overflow-y: auto;
    }
    .node-inspector-body .section-title {
        font-size: 1.1rem;
        font-weight: bold;
        color: #a5b4fc;
        margin-bottom: 12px;
        border-bottom: 1px solid #4f46e5;
        padding-bottom: 8px;
    }
    .stats-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    .stats-list li {
        display: flex;
        justify-content: space-between;
        font-size: 0.9rem;
        padding: 4px 0;
    }
    .stats-list li span:first-child {
        color: #9ca3af;
    }
    .stats-list li span:last-child {
        font-weight: 500;
    }
    
    /* Chapter Transition Screen */
    .chapter-transition-backdrop {
      position: fixed;
      inset: 0;
      z-index: 300;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      animation: chapter-fade-in 1s ease-out, chapter-fade-out 1s 7s ease-in forwards;
      background-color: #000;
    }
    @keyframes chapter-fade-in { from { opacity: 0; } to { opacity: 1; } }
    @keyframes chapter-fade-out { from { opacity: 1; } to { opacity: 0; } }

    .chapter-entity-container {
      width: 40vmin;
      height: 40vmin;
      position: relative;
      filter: drop-shadow(0 0 20px currentColor);
    }

    .chapter-quote {
        position: absolute;
        bottom: 15%;
        left: 50%;
        transform: translateX(-50%);
        width: 80%;
        max-width: 800px;
        text-align: center;
        font-size: 1.75rem;
        color: #e0e7ff;
        text-shadow: 0 0 10px #000;
        opacity: 0;
        animation: fadeInSlow 3s 3s forwards;
    }

    .gas-particle {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle, var(--color-a), transparent 70%);
        animation: gas-coalesce 4s ease-in-out forwards;
    }
    @keyframes gas-coalesce {
        0% {
            transform: translate(var(--x-start), var(--y-start)) scale(var(--s-start));
            opacity: 1;
        }
        70%, 100% {
            transform: translate(0, 0) scale(var(--s-end));
            opacity: var(--o-end, 1);
        }
    }

    /* Single Entity */
    .entity-single-core {
        width: 100%; height: 100%;
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(circle, #ccfbf1, #67e8f9 50%, #06b6d4 80%);
        opacity: 0;
        animation: form-single 3s 2s ease-in-out forwards;
    }
    @keyframes form-single {
        from { transform: scale(0); opacity: 0; }
        to { transform: scale(0.3); opacity: 1; }
    }

    /* Multi Entity */
    .entity-multi-node {
        position: absolute;
        width: 12vmin; height: 12vmin;
        border-radius: 50%;
        background: radial-gradient(circle, #f5d0fe, #d8b4fe 60%, #a855f7 90%);
        opacity: 0;
        animation: form-multi 2s 2s ease-out forwards;
    }
    .entity-multi-node:nth-child(1) { top: 10%; left: 40%; animation-delay: 2s; }
    .entity-multi-node:nth-child(2) { top: 60%; left: 15%; animation-delay: 2.2s; }
    .entity-multi-node:nth-child(3) { top: 60%; left: 65%; animation-delay: 2.4s; }
    @keyframes form-multi {
        from { transform: scale(0); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }
    
    /* Universal Entity */
    .entity-universal-galaxy {
        position: absolute;
        inset: 0;
        border-radius: 50%;
        opacity: 0;
        animation: form-universal 4s 2s ease-out forwards;
    }
    .entity-universal-galaxy .arm {
        position: absolute;
        inset: 0;
        border: 2px solid transparent;
        border-top-color: #fef9c3;
        border-radius: 50%;
        animation: spin 10s linear infinite;
    }
    @keyframes form-universal {
        from { transform: scale(0.1) rotate(-180deg); opacity: 0; filter: blur(20px); }
        to { transform: scale(1) rotate(0deg); opacity: 1; filter: blur(2px); }
    }
    
    /* Pause Overlay */
    .pause-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0,0,0,0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 240; /* Below settings modal (250), above HUD (20) */
        backdrop-filter: blur(4px);
        animation: fadeInSlow 0.5s forwards;
        opacity: 0;
        pointer-events: all;
        cursor: default;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="importmap">
  {
    "imports": {
      "react": "https://aistudiocdn.com/react@^19.1.1",
      "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/",
      "react/": "https://aistudiocdn.com/react@^19.1.1/",
      "@google/genai": "https://aistudiocdn.com/@google/genai@^1.21.0"
    }
  }
  </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>